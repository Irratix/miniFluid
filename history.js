// compressed with https://xem.github.io/terser-online/

function e(e,a,r){this.posx=e,this.posy=a,this.wallflag=r,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.density=0}accuracy=1,Gravity=1,Pressure=3,Viscosity=4,w=79*accuracy,h=25*accuracy,scale=2;var a=[];canvas.width=w*scale,canvas.height=h*scale;var r=canvas.getContext("2d");previewarea.cols=w,previewarea.rows=h,init=()=>{a=[];for(var r=previewarea.value,s=0,t=0,c=0;c<r.length;c++){var i=r[c];if("\n"===i)s+=accuracy,t=0;else if(" "!==i){for(var o="#"===i,y=0;y<accuracy;y++)for(var l=0;l<accuracy;l++)a.push(new e(t+y,s+l,o));t+=accuracy}else t+=accuracy}},density=()=>{for(var e=0;e<a.length;e++){var r=a[e];r.density=r.wallflag?9:0;for(var s=0;s<a.length;s++){var t=a[s],c=r.posx-t.posx,i=r.posy-t.posy,o=c*c+i*i;if(o<4){var y=Math.sqrt(o)/2-1;r.density+=y*y}}}},force=()=>{for(var e=0;e<a.length;e++){var r=a[e];r.forcey=Gravity,r.forcex=0;for(var s=0;s<a.length;s++){var t=a[s],c=r.posy-t.posy,i=r.posx-t.posx,o=c*c+i*i;if(o<4){var y=Math.sqrt(o)/2-1;r.forcey+=(c*(3-r.density-t.density)*Pressure+r.vely*Viscosity-t.vely*Viscosity)*y/r.density,r.forcex+=(i*(3-r.density-t.density)*Pressure+r.velx*Viscosity-t.velx*Viscosity)*y/r.density}}}},draw=()=>{canvas.width^=0,r.fillStyle="#0008";for(var e=0;e<a.length;e++){var s=a[e],t=s.posx,c=s.posy;s.wallflag||(s.posy+=s.vely+=s.forcey/10,s.posx+=s.velx+=s.forcex/10),0<=t&&t<w&&0<=c&&c<h&&(r.beginPath(),r.arc(t*scale,c*scale,scale,0,7),r.fill())}},nextframe=()=>{density(),force(),draw()},fetch("inputs/endoh1.c").then(e=>e.text()).then(e=>{previewarea.value=e,init(),setInterval(nextframe,33)})